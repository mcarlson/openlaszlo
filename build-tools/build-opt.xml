<target name="build-opt" unless="done.build-opt">

<!-- * X_LZ_COPYRIGHT_BEGIN ***************************************************
* Copyright 2001-2006 Laszlo Systems, Inc.  All Rights Reserved.              *
* Use is subject to license terms.                                            *
* X_LZ_COPYRIGHT_END ****************************************************** -->

    <property environment="env"/>

    <!-- make sure we have a working LPS_HOME -->
    <if><isset property="env.LPS_HOME" /><then>
        <property name="LPS_HOME" value="${env.LPS_HOME}" />
    </then></if>
    <if><not><isset property="LPS_HOME" /></not><then>
        <fail message="LPS_HOME not set" />
    </then></if>
    <basename property="lps.branch" file="${LPS_HOME}"/>

    <!-- make sure we have a working VENDOR_ROOT -->
    <if><isset property="env.VENDOR_ROOT" /><then>
        <property name="VENDOR_ROOT" value="${env.VENDOR_ROOT}" />
    </then></if>
    <if><not><isset property="VENDOR_ROOT" /></not><then>
        <property name="VENDOR_ROOT" value="${LPS_HOME}/../tools" />
    </then></if>

    <property name="build.tools" value="" />
    <property name="build.qa" value="" />
    <if><not><equals arg1="${user.name}" arg2="builder" /></not><then>
        <property name="build.id" value="INTERNAL" />
    </then></if>

    <!-- Determine value of platform -->
    <condition property="build.platform" value="windows" >
        <os family="windows" />
    </condition>
    <condition property="build.platform" value="macosx" >
         <os name="Mac OS X" />
    </condition>
    <condition property="build.platform" value="unix" >
        <os family="unix" />
    </condition>

    <!-- Determine value of filesystem casesensitivity -->
    <condition property="filesystem.casesensitive" value="false" >
        <os family="windows" />
    </condition>
    <condition property="filesystem.casesensitive" value="false" >
         <os name="Mac OS X" />
    </condition>
    <condition property="filesystem.casesensitive" value="true" >
        <os family="unix" />
    </condition>

    <!-- Set script extension for platform -->
    <condition property="sh" value="bat" >
         <os family="windows" />
    </condition>
    <condition property="sh" value="sh" >
         <os name="Mac OS X" />
    </condition>
    <condition property="sh" value="sh" >
         <os family="unix" />
    </condition>

    <property name="done.build-opt" value="true" />
</target>
