 <html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="STYLESHEET" type="text/css" href="./styles.css" /></head>
<body>

<!-- ===================================================================== -->
<!-- = XML information goes here                                         = -->
<!-- ===================================================================== -->
<lzelement title="Connection">
    <lztier>LFC</lztier>
    <lzcategory>Persistent Connection</lzcategory>
    <lzshortdesc>
        A connection manager to create a persistent connection and an
        authenticated session.
    </lzshortdesc>
    <lztag>tag-connection.xml</lztag>
    <lzapi>api-lzconnection.xml</lzapi>
</lzelement>

<p>The <tagname>connection</tagname> tag instantiates a connection
manager object that handles asynchronous messages sent from the OpenLaszlo
Server. Use the the <method>LzConnection.connect</method> method to establish a
persistent connection and <method>disconnect</method> to close it down.</p>

<example title="Connection example" >
&lt;canvas debug="true" height="200"&gt;
  &lt;debug y="60"/&gt;
  &lt;connection authenticator="anonymous"&gt;
    &lt;handler name="onconnect"&gt;
      Debug.write('connected');
    &lt;/handler&gt;
    &lt;handler name="ondisconnect"&gt;
      Debug.write('client disconnected');
    &lt;/handler&gt;
  &lt;/connection&gt;

  &lt;view&gt;
    &lt;simplelayout axis="x" spacing="5"/&gt;
    &lt;button&gt;connect
      &lt;handler name="onclick"&gt;
        canvas.connection.connect();
      &lt;/handler&gt;
    &lt;/button&gt;
    &lt;button&gt;disconnect
      &lt;handler name="onclick"&gt;
        canvas.connection.disconnect();
      &lt;/handler&gt;
    &lt;/button&gt;
  &lt;/view&gt;
&lt;/canvas&gt;
</example>

<p>You can optionally use the <method>clientDisconnect</method> method to close
down only the client-side connection. The server will drop its end of the
connection when it next becomes aware that the connection has been dropped.</p>

<p>The previous example declares <tagname>connection</tagname> with
<code>authenticator="anonymous"</code>, which tells the connection
manager that no authentication should be used to handle the persistent
connection. Normally, the connection manager will tell the OpenLaszlo Server to
verify that your connection is authenticated with a back-end
authentication server before allowing the persistent connection, which
is done through a session cookie. The default authentication server it
uses is the <code>AuthenticationServlet</code> bundled with the OpenLaszlo Server. The set of usernames that server uses is located in
<tt>lps/config/lzusers.xml</tt>. To session and unsession your
application, use the connection's <method>login</method> and
<method>logout</method> methods.</p>

<p>The next example demonstrates how to login with the username
<code>adam</code>. Note that you will be allowed to connect only after
logging in.</p>

<example title="Session Example">
&lt;canvas debug="true" height="200"&gt;
  &lt;debug y="60"/&gt;

  &lt;connection&gt;
    &lt;handler name="onconnect"&gt;
      Debug.write('connected as ' + connection.getUsername()); 
    &lt;/handler&gt;
    &lt;handler name="ondisconnect"&gt;
      Debug.write('client disconnected');
    &lt;/handler&gt;
  &lt;/connection&gt;

  &lt;datapointer xpath="connection:loginDset:/login[1]/authentication[1]/response[1]/status[1]"&gt;
    &lt;handler name="ondata"&gt;
      var statusMessage = this.xpathQuery('@msg');
      Debug.write('login: ' + statusMessage);
    &lt;/handler&gt;
    &lt;handler name="onerror"&gt;
      Debug.write('login resulted in error');
    &lt;/handler&gt;
    &lt;handler name="ontimeout"&gt;
      Debug.write('login timed out');
    &lt;/handler&gt;
  &lt;/datapointer&gt;

  &lt;datapointer xpath="connection:logoutDset:/logout[1]/authentication[1]/response[1]/status[1]"&gt;
    &lt;handler name="ondata"&gt;
      var statusMessage = this.xpathQuery('@msg');
      Debug.write('logout: ' + statusMessage);
    &lt;/handler&gt;
    &lt;handler name="onerror"&gt;
      Debug.write('logout resulted in error');
    &lt;/handler&gt;
    &lt;handler name="ontimeout"&gt;
      Debug.write('logout timed out');
    &lt;/handler&gt;
  &lt;/datapointer&gt;

  &lt;view&gt;
    &lt;simplelayout axis="x" spacing="5"/&gt;
    &lt;button&gt;login
      &lt;handler name="onclick"&gt;
        canvas.connection.login('adam', 'adam');
      &lt;/handler&gt;
    &lt;/button&gt;
    &lt;button&gt;logout
      &lt;handler name="onclick"&gt;
        canvas.connection.logout();
      &lt;/handler&gt;
    &lt;/button&gt;
    &lt;simplelayout axis="x" spacing="5"/&gt;
    &lt;button&gt;connect
      &lt;handler name="onclick"&gt;
        canvas.connection.connect();
      &lt;/handler&gt;
    &lt;/button&gt;
    &lt;button&gt;disconnect
      &lt;handler name="onclick"&gt;
          canvas.connection.disconnect();
      &lt;/handler&gt;
    &lt;/button&gt;
  &lt;/view&gt;
&lt;/canvas&gt;
</example>

<p>Once a connection is established, clients can send and receive messages
using the <tagname>connectiondatasource</tagname> tag.</p>

<h2>Sample Apps</h2>
<p>Sample applications that use the <tagname>connection</tagname> tag are:</p>
<ul>
    <li> <a href="${demos}chat">Chat</a></li>
    <li> <a href="${demos}dashboard">Dashboard</a></li>
</ul>

<seealso>
<tags>connectiondatasource</tags>
<dguide id="persistent_connection" title="Persistent Connection">for
more information on authentication, asynchronous XML messages, and
other persistent connection-related matters</dguide>
</seealso>

</body>
</html>
<!-- * X_LZ_COPYRIGHT_BEGIN ***************************************************
* Copyright 2001-2006 Laszlo Systems, Inc.  All Rights Reserved.              *
* Use is subject to license terms.                                            *
* X_LZ_COPYRIGHT_END ****************************************************** -->
