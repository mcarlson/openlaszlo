<chapter id="two-way-databinding">
<title>Two-way databinding</title>
<section><title>Introduction</title>
<para>
Until now, we've looked mostly at the case where changes in a dataset update the visible LZX nodes to which the data is bound. Now we'll take a look at the opposite direction, that is, when changes in the views&#8212;for example, when an application user types something into a text field&#8212; get propagated back into the dataset. This is often accomplished by mixing static and dynamic databinding.
</para>
<para>
Therefore, as part of this discussion, we'll take a closer look at the correspondence between the datapath/datapointer APIs and their equivalence in DOM/LzNode APIs. 
</para>
<para>
As we have seen, once a view has been bound to a dataset, if the data changes, the data-bound object also updates.
Sometimes, with input controls, you need to bind back into the data.
</para>
<para>
To trigger two-way databinding:
</para>
<itemizedlist spacing="compact">
    <listitem><para>
    Call datapath.updateData().
    </para></listitem>
    <listitem><para>   
    Optionally, define an updateData() method at the root of the control. This method is called automatically and returns the value to put back into the data.
    </para></listitem>
</itemizedlist>

<para>
Explanation of actions that can be performed using only one or the other approach.

</para>
</section>
<section><title>Equivalence of Static and Dynamic APIs</title>
<!--article lang=""-->
  <informaltable frame="all">
    <tgroup cols="3">
      <tbody>
        <row>
          <entry>
            <para>Datapointer Classes</para>
          </entry>

          <entry>
            <para>DataNode Classes</para>
          </entry>
          <entry>
            <para>Description</para>
          </entry>
        </row>
        <row>

          <entry>
            <para>addNode</para>
          </entry>
          <entry>
            <para>appendChild</para>
          </entry>
          <entry>
            <para>Adds a new child node below the current
            context</para>

          </entry>
        </row>
        <row>
          <entry>
            <para>deleteNode</para>
          </entry>
          <entry>
            <para>removeChild</para>

          </entry>
          <entry>
            <para>Removes the referenced node</para>
          </entry>
        </row>
        <row>
          <entry>
            <para>deleteNodeAttribute</para>

          </entry>
          <entry>
            <para>removeAttr</para>
          </entry>
          <entry>
            <para>Removes the name attribute from the current
            node</para>
          </entry>
        </row>

        <row>
          <entry>
            <para>getChild</para>
          </entry>
          <entry>
            <para>getFirstChild and getLastChild</para>
          </entry>
          <entry>

            <para>Gets a specified child node</para>
          </entry>
        </row>
        <row>
          <entry>
            <para>getNodeAttribute</para>
          </entry>
          <entry>

            <para>getAttr</para>
          </entry>
          <entry>
            <para>Returns the value of the current node's name
            attribute</para>
          </entry>
        </row>
        <row>
          <entry>

            <para>getNodeName</para>
          </entry>
          <entry>
            <para>NodeName (LzDataNode attribute)</para>
          </entry>
          <entry>
            <para>Gets the name of the node that the data pointer
            is pointing to</para>

          </entry>
        </row>
        <row>
          <entry>
            <para>getNodeText</para>
          </entry>
          <entry>
            <para>data (LzDataText attribute)</para>

          </entry>
          <entry>
            <para>Returns a string that is a concatenation of the
            text nodes beneath the current element</para>
          </entry>
        </row>
        <row>
          <entry>
            <para>selectNext</para>

          </entry>
          <entry>
            <para>getNextSibling</para>
          </entry>
          <entry>
            <para>Selects the next sibling node in the
            dataset</para>
          </entry>
        </row>

        <row>
          <entry>
            <para>selectPrev</para>
          </entry>
          <entry>
            <para>getPreviousSibling</para>
          </entry>
          <entry>

            <para>Selects the previous sibling node in the
            dataset</para>
          </entry>
        </row>
        <row>
          <entry>
            <para>selectParent</para>
          </entry>
          <entry>

            <para>parentNode (LzDataNode attribute)</para>
          </entry>
          <entry>
            <para>Moves up the data hierarchy to the next parent
            node in the dataset</para>
          </entry>
        </row>
        <row>
          <entry>

            <para>serialize</para>
          </entry>
          <entry>
            <para>serialize</para>
          </entry>
          <entry>
            <para>Serializes the current element and its children
            to an XML string</para>

          </entry>
        </row>
        <row>
          <entry>
            <para>setNodeAttribute</para>
          </entry>
          <entry>
            <para>setAttr</para>

          </entry>
          <entry>
            <para>Sets the name attribute of the current node to
            the val argument</para>
          </entry>
        </row>
        <row>
          <entry>
            <para>setNodeName</para>

          </entry>
          <entry>
            <para>setNodeName</para>
          </entry>
          <entry>
            <para>Sets the name of the current element to the name
            argument</para>
          </entry>
        </row>

        <row>
          <entry>
            <para>setNodeText</para>
          </entry>
          <entry>
            <para>setData</para>
          </entry>
          <entry>

            <para>Sets the current node's text to the text
            argument</para>
          </entry>
        </row>
      </tbody>
    </tgroup>
  </informaltable>

<!--/article-->
<para>
Datapointer and DataElement

-- Deleting a Node
-- Creating a Node
---Accessing a LzDataelement
---Using a LzDataelement
---Destroying a Node
</para>
</section>
<section>
<title>
Changing Data Binding with Attribute p</title>
<para>
This example shows how to change the datapath of an object using the p attribute.
</para>
<para>
The onclick handler inside the button sets the p attribute of the firstview object to be the p attribute of the secondview object: 
</para>
<para>
      parent.firstview.datapath.setAttribute("p", parent.secondview.datapath.p);
</para>
</section>
<section>
<title>The "p" attribute of datapointers</title>
<para>
The .p property is the gateway between static and dynamic APIs.
Every datapath and datapointer has a .p property, which is the LzNode to which it points. Therefore, you can use the DOM APIs on the .p attribute of datapaths and datapointers.
</para>
<example role="live-example">
   <title>Changing Data Binding with Attribute p </title>
   <programlisting language="lzx">
   <textobject><textdata fileref="programs/data-setattribute_p.lzx"/></textobject> 
   </programlisting>
</example>
</section>
<section>
<title>
Exploring Two-way Data Binding </title>
<para>
This example shows that when data in a dataset changes, any objects that are databound to that data automatically get updated (there is automatic synchronization between the data layer and the UI layer). 
</para>
<para>

Using the datapath attribute, display the last name of the first contact in the first text object: 
</para>
<para>
&lt;text resize="true" name="lastnameinitcaps" 
    datapath="dset:/addressbook/contacts/person[1]/@lastname" /&gt; 
</para>
<para>
Using the datapath attribute, databind the edittext object to the same lastname attribute, as in Step 1: 
</para>
<para>
&lt;edittext width="300" name="lastnameedit" 
    datapath="dset:/addressbook/contacts/person[1]/@lastname"&gt; 
</para>
<para>
The above shows how the dataset controls the what is displayed. Now let's look at how the updateData() method works in the other direction, when the changes to the databound attributes can be propagated back to the dataset. Examine the
onclick event handler for the button. When the button is clicked, it programmatically synchronizes the data and the UI layer of the lastnameedit using the updateData() method of its datpath object: 
</para>
<para>
      parent.lastnameedit.datapath.updateData();
</para>
</section>
<section><title>
The .data property</title>
<para>
-- .data is shorthand for datapath.p
-- Objects like views have a .data property when they are databound and replicated. Otherwise .data is null.
</para>
</section>
</chapter>
