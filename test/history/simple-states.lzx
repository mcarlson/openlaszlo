<canvas width="1400" height="600" debug="true">
  <debug width="500" height="500" fontsize="12" x="450"/>

  <!-- Click on blob START, STATE_2, STATE_3, END, then click browser back button -->

  <!-- a blob you can click on to select -->
  <class name="blob" extends="drawview" width="100" height="100">
    <attribute name="title" type="text"/>
    <attribute name="selected" type="boolean" />
    <text y="20" x="4" fontsize="16" text="${parent.title}"/>
    <method event="onclick">
      this.setAttribute('selected', true);
      main.selectBlob(this);
    </method>

    <method name="select" args="val">
      if (val) {
      // draw a border to select
        this.lineStyle = 0x000000;
        this.lineWidth = 4;
        moveTo(0,0);
        lineTo(0,100);
        lineTo(100,100);
        lineTo(100,0);
        lineTo(0,0);
        stroke();
      } else {
          clear();
      }
    </method>

  </class>

  <!-- A view with four states -->
  <view id="main" x="10" y="10"  layout="axis: x; spacing: 10">
    <attribute name="mystate" type="string" value="START"/>

    <blob bgcolor="#ffcccc" id="s1" title="START"/>
    <blob bgcolor="#ccccff" id="s2" title="STATE_2"/>
    <blob bgcolor="#ccffcc" id="s3" title="STATE_3"/>
    <blob bgcolor="#cccccc" id="s4" title="END"/>

    <method name="unselectAll">
      s1.select(false);
      s2.select(false);
      s3.select(false);
      s4.select(false);
    </method>

    <method name="selectBlob" args="blob">
      // save the old state
      LzHistory.next();
      this.mystate = blob.title;
      unselectAll();
      blob.select(true);
      recordState(blob.title);
    </method>

    <method event="oninit">
      unselectAll();
      selectBlob(s1);
    </method>

    <method event="onmystate">
      Debug.write("got onmystate event: ", this.mystate);
      gotoState(this.mystate);
    </method>

    <method name="recordState" args="newstate">
      this.mystate = newstate;
      LzHistory.save(this,'mystate', this.mystate);
      Debug.write("recordState", newstate, "LzHistory.offset "+LzHistory.offset)
    </method>

    <method name="gotoState" args="ns">
      unselectAll();
      if (ns == "START") {
          s1.select(true);
      } else if (ns == "STATE_2") {
          s2.select(true);
      } else if (ns == "STATE_3") {
          s3.select(true);
      } else if (ns == "END") {
          s4.select(true);
      }

    </method>
  </view>

  <simplelayout/>
  <text text="${LzHistory.offset}"/>

</canvas>
