<!-- MicroSlash - An RDF reader for Slashdot.org        -->
<!-- Author: Anthony Martin <anthony@martin-studio.com> -->

<canvas debug="false" bgcolor="white" width="400">

 <splash />

 <dataset type="http" name="slashData" src="http://slashdot.org/index.rss" request="true" />

 <simplelayout axis="y" spacing="2" />

 <view>

  <attribute name="channelLink" type="string" value="" />
  <attribute name="searchKey" type="string" value="" />
  <attribute name="searchLink" type="string" value="" />

  <simplelayout axis="x" spacing="1" />

  <view datapath="slashData:/RDF">
   <method event="ondata">

    var ci = datapath.dupePointer() ;
    var cd = datapath.dupePointer() ;
    var cl = datapath.dupePointer() ;
    var tn = datapath.dupePointer() ;
    var tl = datapath.dupePointer() ;

    ci.setXPath("channel/image") ;
    channelImage.setResource(ci.getNodeAttribute("resource")) ;
    cd.setXPath("channel/description") ;
    channelDescription.setText(cd.getNodeText()) ;
    cl.setXPath("channel/link") ;
    parent.setAttribute("channelLink", cl.getNodeText()) ;
    tn.setXPath("textinput/name") ;
    parent.setAttribute("searchKey", tn.getNodeText()) ;
    tl.setXPath("textinput/link") ;
    parent.setAttribute("searchLink", tl.getNodeText()) ;

   </method>
   <simplelayout axis="y" spacing="2" />
   <view id="channelImage" bgcolor="white">
   </view>
   <view>
    <text id="channelDescription" fontstyle="bold" fgcolor="black" resize="true" />
    <method event="onclick">
     LzBrowser.loadURL(parent.parent.channelLink) ;
    </method>
   </view>
   <view>
    <simplelayout axis="x" spacing="1" />
    <edittext id="phrase" width="200" />
    <button id="search">
     Search
     <method event="onclick">
      LzBrowser.loadURL(parent.parent.parent.searchLink + "?" + parent.parent.parent.searchKey + "=" + phrase.getText()) ;
     </method>
    </button>
   </view>
  </view>

  <view width="64" />

  <view id="topicIcon" name="topicIcon" height="78" bgcolor="white">
   <simplelayout axis="y" spacing="2" />
   <method name="setTopicIcon" args="subject">

    var TOPIC_IMAGE_PREFIX = "http://images.slashdot.org/topics/" ;

    // Remap for icons that don't match exactly with the subject name.
    if ( subject == "" ) {
      subject = "article" ;
    } else if ( subject == "microsoft" ) {
      subject = "ms" ;
    } else if ( subject == "biz" ) {
      subject = "business" ;
    } else if ( subject == "tech" ) {
      subject = "tech2" ;
    } else if ( subject == "usa" ) {
      subject = "us" ;
    }

    var url = TOPIC_IMAGE_PREFIX + "/topic" + subject + ".gif" ;
    setResource(url) ;

   </method>
  </view>

 </view>

 <view name="table">
  <simplelayout axis="y" spacing="1" />
  <view datapath="slashData:/RDF/item" width="400">
   <simplelayout axis="y" />
   <view width="400">
    <simplelayout axis="x" />
    <view resource="images/slc.gif" bgcolor="#006666" />
    <text datapath="title/text()" fontstyle="bold" bgcolor="#006666" fgcolor="white" width="400" height="16" />
    <method event="onmouseover">
     var dp = parent.datapath.dupePointer() ;
     parent.details.setVisible(true) ;
     dp.setXPath("subject") ;
     topicIcon.setTopicIcon(dp.getNodeText()) ;
     tooltip.show("Subject: " + dp.getNodeText()) ;
    </method>
    <method event="onmouseout">
     parent.details.setVisible(false) ;
    </method>
    <method event="onclick">
     var dp = parent.datapath.dupePointer() ;
     dp.setXPath("link") ;
     LzBrowser.loadURL(dp.getNodeText()) ;
    </method>
   </view>
   <view name="details" visible="false">
    <simplelayout axis="y" />
    <view>
     <simplelayout axis="x" />
     <text fontstyle="bold" resize="true">Posted by </text>
     <text datapath="creator/text()" fontstyle="bold" resize="true" />
     <text fontstyle="bold" resize="true"> on </text>
     <text datapath="date/text()" fontstyle="bold" resize="true" />
    </view>
    <view>
     <simplelayout axis="x" />
     <text fontstyle="bold" resize="true">from the </text>
     <text datapath="department/text()" fontstyle="bold" resize="true" />
     <text fontstyle="bold" resize="true"> dept.</text>
    </view>
   </view>
  </view>
 </view>

 <view datapath="slashData:/RDF/channel" align="center" width="400">
  <text datapath="rights/text()" fgcolor="black" resize="true" fontsize="6" />
 </view>

 <!-- tooltip -->
 <!-- Stolen from: http://www.mylaszlo.com/lps/ptw/tunaroll/tunaroll.lzx -->
 <view id="tooltip" options="ignorelayout" opacity="0" visible="false">

  <attribute name="tip" type="string" value="" />
  <attribute name="mousex" value="0" />
  <attribute name="mousey" value="0" />
  <attribute name="p" value="0" />
  <attribute name="v" value="0" />
  <attribute name="ignore" value="0" />

  <method name="show" args="tip"><![CDATA[

   this.setAttribute('opacity', 0);
   this.tip = tip;
   this.mousex = canvas.getMouse('x');
   this.mousey = canvas.getMouse('y');
   // send event
   this.p++;

  ]]></method>

  <method name="check"><![CDATA[

   var pnow = this.p;
   // check for event
   if (pnow > this.v) {
     this.v = pnow;
     this.setAttribute('visible', true);
   }

  ]]></method>

  <method name="update"><![CDATA[
   // get size
   this.display.setAttribute('text', this.tip);
   // clip to canvas
   var newx = this.mousex - this.width;
   if (newx < 0) newx = 5;
   var newy = this.mousey - this.height;
   if (newy < 0) newy = 5;
   // move
   this.setAttribute('x', newx);
   this.setAttribute('y', newy);
  ]]></method>

  <animatorgroup name="shower" process="sequential" repeat="Infinity" start="true">

   <animator attribute="ignore" motion="linear" to="0" duration="500">
    <method event="onstart">
      this.parent.parent.check() ;
    </method>
   </animator>

   <animator attribute="opacity" to=".9" duration="250" motion="easein">
    <method event="onstart">
     this.parent.parent.update() ;
    </method>
   </animator>

   <animator attribute="ignore" motion="linear" to="0" duration="1500" />

   <animator attribute="opacity" to="0" duration="500" motion="easein">
    <method event="onstop">
     this.parent.parent.setVisible(false) ;
    </method>
   </animator>
  </animatorgroup>

  <text name="display" resize="true" text="" bgcolor="#FFFF99" fgcolor="#000000" />

 </view>

<!--
 <button>
  Dump
  <method event="onclick">
   debug.write(resourceArea.datapath.serialize()) ;
  </method>
 </button>
-->

</canvas>
<!-- * X_LZ_COPYRIGHT_BEGIN ***************************************************
* Copyright 2001-2004 Laszlo Systems, Inc.  All Rights Reserved.              *
* Use is subject to license terms.                                            *
* X_LZ_COPYRIGHT_END ****************************************************** -->
