<canvas debug="true">
  <debug y="30%" height="65%" />

  <import name="form_tenforty_snippet"
          href="1040/form_tenforty.lzx" stage="defer"
          onload="mybutt.handleTenFortyLoad()" />

  <simplelayout axis="y" spacing="5" />
  <text multiline="true">
    Push the buttons in order.  Wait for 'Trace done' after 'MarkObjects' and 'FindNewObjects'
    before pressing the next button.  Inspect the leaks.  There should only be 'noise'
  </text>

  <view>
    <simplelayout axis="x" spacing="5" />

    <button>
      markObjects
      <method event="onclick">
        Debug.markObjects();
      </method>
    </button>

    <button id="mybutt">
      Load 1040
      <!-- The instance of the form -->
      <attribute name="f" value="null" />
      <method event="onclick">
        if ( global.hasOwnProperty('form_tenforty') ) {
            instantiateTenForty();
        } else {
            form_tenforty_snippet.load();
        }
      </method>

      <method name="handleTenFortyLoad">
        instantiateTenForty();
      </method>

      <method name="instantiateTenForty">
        this.f = new form_tenforty( this, {x:40,y:40});
      </method>
    </button>

    <button>
      Remove 1040
      <method event="onclick">
        <![CDATA[
                 // the instance
                 mybutt.f.destroy();
                 if (! delete mybutt.f) {
                     Debug.error("Couldn't delete %w", mybutt.f);
                 }
                 // the class
                 form_tenforty.destroy();
                 form_tenforty_snippet.unload();
        ]]>
      </method>
    </button>

    <button>
      findNewObjects
      <method event="onclick">
        Debug.findNewObjects();
      </method>
    </button>

    <button>
      whyAlive
      <method event="onclick">
        var why = Debug.whyAlive();
        Debug.format("Why Alive: %w\n", why);
        Debug.inspect(why);
      </method>
    </button>
  </view>
</canvas>
